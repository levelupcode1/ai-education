# 구독 모델과 인앱 결제 시스템 구축하기

## 학습 목표
- 인앱 결제의 기본 개념 이해하기
- Flutter에서 인앱 결제 구현 방법 배우기
- 구독 모델 설계 및 구현하기
- 결제 관련 법적 고려사항 파악하기

## 1. 인앱 결제 개요

### 인앱 결제란?
인앱 결제(In-App Purchase, IAP)는 앱 내에서 디지털 상품이나 서비스를 구매할 수 있는 시스템입니다. 사용자는 앱을 떠나지 않고도 앱 스토어의 결제 시스템을 통해 안전하게 결제할 수 있습니다.

### 인앱 결제 유형
- **소모품**: 한 번 사용하면 소진되는 아이템 (예: 게임 내 코인)
- **비소모품**: 영구적으로 사용 가능한 콘텐츠 (예: 앱 기능 잠금 해제)
- **구독**: 정기적으로 갱신되는 서비스 (예: 월간 프리미엄 멤버십)

### 앱 스토어별 수수료
- Google Play: 일반적으로 매출의 15-30%
- Apple App Store: 일반적으로 매출의 15-30%

## 2. Flutter에서 인앱 결제 설정

### 필요한 패키지
- in_app_purchase 패키지 설치
- 플랫폼별 설정 요구사항

### 스토어별 설정
- Google Play Console 설정
- App Store Connect 설정
- 테스트 계정 및 환경 구성

## 3. 상품 구성 및 등록

### 상품 유형 결정
- MBTI 테스트 앱에 적합한 상품 유형
- 가격 전략 및 경쟁사 분석

### Google Play 상품 등록
- Play Console에서 상품 등록 방법
- 상품 ID 및 설명 관리

### App Store 상품 등록
- App Store Connect에서 상품 등록
- 인앱 구매 설정 및 검토 프로세스

## 4. 기본 인앱 결제 구현

### 상품 정보 조회
- 스토어에서 상품 정보 가져오기
- 가격, 설명 등 표시

### 구매 프로세스 구현
- 구매 요청 처리
- 결제 상태 확인
- 구매 완료 처리

### 오류 처리
- 결제 실패 시나리오 대응
- 네트워크 오류 처리
- 사용자 피드백 제공

## 5. 구독 모델 구현

### 구독 상품 설계
- 구독 기간 및 혜택 정의
- 무료 체험 기간 설정
- 자동 갱신 설정

### 구독 상태 관리
- 현재 구독 상태 확인
- 만료일 추적
- 갱신 알림 구현

### 구독 취소 및 환불 처리
- 사용자 취소 프로세스
- 환불 정책 및 처리 방법

## 6. 프리미엄 콘텐츠 관리

### 콘텐츠 잠금 시스템
- 구매 상태에 따른 콘텐츠 접근 제어
- 로컬 및 서버 측 검증

### MBTI 앱 프리미엄 기능
- 광고 제거
- 상세 유형 분석
- 추가 테스트 및 결과
- 커스텀 테마 및 기능

### 사용자 경험 최적화
- 프리미엄 혜택 명확히 커뮤니케이션
- 구매 흐름 단순화
- 전환율 개선 전략

## 7. 서버 측 검증

### 서버 측 검증의 중요성
- 클라이언트 측 해킹 방지
- 거래 기록 유지
- 구독 상태 신뢰성 확보

### Firebase 사용한 검증
- Firebase Functions 설정
- Google Play 영수증 검증
- App Store 영수증 검증

### 사용자 상태 동기화
- 여러 기기 간 구매 상태 동기화
- 클라우드 기반 사용자 데이터 관리

## 8. 법적 고려사항

### 환불 정책
- 스토어별 환불 정책 이해
- 앱 내 환불 정책 명시

### 구독 갱신 공지
- 자동 갱신 전 알림 의무
- 갱신 조건 명확한 표시

### 개인정보 보호
- 결제 정보 처리 관련 규정
- 개인정보 처리방침 업데이트

## 실습 과제
1. Flutter 프로젝트에 in_app_purchase 패키지 설정하기
2. MBTI 테스트 앱에 비소모품(프리미엄 기능) 구현하기
3. 월간/연간 구독 모델 구현하기
4. 구매 상태에 따른 UI 조건부 표시 구현하기